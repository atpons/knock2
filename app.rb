require "dotenv"
require "oauth2"
require "google_drive"
require "pp"

Dotenv.load

client = OAuth2::Client.new(
                ENV["client_id"],
                ENV["client_secret"],
                site: "https://accounts.google.com",
                token_url: "/o/oauth2/token",
                authorize_url: "/o/oauth2/auth")
auth_token = OAuth2::AccessToken.from_hash(client,{:refresh_token => ENV["refresh_token"], :expires_at => 3600})
        auth_token = auth_token.refresh!
session = GoogleDrive.login_with_oauth(auth_token.token)
        @ws = session.spreadsheet_by_key(ENV["sheet_id"]).worksheets[0]

        puts "Please input your student id:"
        @id = gets.chomp!

        @ws.rows.each_with_index do |data, i|
        if data[1].to_s == @id then
        if data[0] == "0" then
        puts "Welcome to the room!"
        @ws[i+1,1] = "1"
        @ws.save
        elsif data[0] == "1" then
        puts "See you again!"
        @ws[i+1,1] = "0"
        @ws.save
        else
        puts "Sorry, unrecognized flag is opened and you are exited from the room."
        @ws[i+1,1] = "0" # å¼·åˆ¶zero
        @ws.save
        end
        end
        end
[?1049h[H[2J[?2004h[?1004h[8;24;80t[1;1H(B[m[38;5;255m[48;5;235m                                                                                [2;1H                                                                                [3;1H                                                                                [4;1H                                                                                [5;1H                                                                                [6;1H                                                                                [7;1H                                                                                [8;1H                                                                                [9;1H                                                                                [10;1H                                                                                [11;1H                                                                                [12;1H                                                                                [13;1H                                                                                [14;1H                                                                                [15;1H                                                                                [16;1H                                                                                [17;1H                                                                                [18;1H                                                                                [19;1H                                                                                [20;1H                                                                                [21;1H                                                                                [22;1H                                                                                [23;1H                                                                                [24;1H                                                                                [1;1H[1;1H[?12l[?25h[?25l[?1002h[?1006h[1;1H                                                                                [2;1H                                                                                [3;1H                                                                                [4;1H                                                                                [5;1H                                                                                [6;1H                                                                                [7;1H                                                                                [8;1H                                                                                [9;1H                                                                                [10;1H                                                                                [11;1H                                                                                [12;1H                                                                                [13;1H                                                                                [14;1H                                                                                [15;1H                                                                                [16;1H                                                                                [17;1H                                                                                [18;1H                                                                                [19;1H                                                                                [20;1H                                                                                [21;1H                                                                                [22;1H                                                                                [23;1H                                                                                [24;1H                                                                                [1;1H[24;1H(B[m[38;5;255m[48;5;235m"app.rb"[24;9H[?12l[?25h[?25l[24;10H[noeol][24;18H39L,[24;23H5515C[24;28H[?12l[?25h[?25l[1;1H(B[m[38;5;81m[48;5;235m  1 (B[m[38;5;185m[48;5;236mrequire(B[m[38;5;255m[48;5;236m (B[m[38;5;81m[48;5;236m"(B[m[38;5;180m[48;5;236mdotenv(B[m[38;5;81m[48;5;236m"(B[m[38;5;255m[48;5;236m                                                            [2;1H(B[m[38;5;238m[48;5;235m  2 (B[m[38;5;185m[48;5;236mr(B[m[38;5;185m[48;5;235mequire[2;13H(B[m[38;5;81m[48;5;235m"(B[m[38;5;180m[48;5;235moauth2(B[m[38;5;81m[48;5;235m"[3;1H(B[m[38;5;238m[48;5;235m  3 (B[m[38;5;185m[48;5;236mr(B[m[38;5;185m[48;5;235mequire[3;13H(B[m[38;5;81m[48;5;235m"(B[m[38;5;180m[48;5;235mgoogle_drive(B[m[38;5;81m[48;5;235m"[4;1H(B[m[38;5;238m[48;5;235m  4 (B[m[38;5;185m[48;5;236mr(B[m[38;5;185m[48;5;235mequire[4;13H(B[m[38;5;81m[48;5;235m"(B[m[38;5;180m[48;5;235mpp(B[m[38;5;81m[48;5;235m"[5;1H(B[m[38;5;238m[48;5;235m  5 (B[m[38;5;255m[48;5;236m [6;1H(B[m[38;5;238m[48;5;235m  6 (B[m[38;5;81m[48;5;236mD(B[m[38;5;81m[48;5;235motenv(B[m[38;5;255m[48;5;235m.load[7;1H(B[m[38;5;238m[48;5;235m  7 (B[m[38;5;255m[48;5;236m [8;1H(B[m[38;5;238m[48;5;235m  8 (B[m[38;5;255m[48;5;236mc(B[m[38;5;255m[48;5;235mlient[8;12H=[8;14H(B[m[38;5;81m[48;5;235mOAuth2(B[m[38;5;255m[48;5;235m::(B[m[38;5;81m[48;5;235mClient(B[m[38;5;255m[48;5;235m.new([9;1H(B[m[38;5;238m[48;5;235m  9 (B[m[38;5;255m[48;5;236m [9;21H(B[m[38;5;153m[48;5;235mENV(B[m[38;5;255m[48;5;235m[(B[m[38;5;81m[48;5;235m"(B[m[38;5;180m[48;5;235mclient_id(B[m[38;5;81m[48;5;235m"(B[m[38;5;255m[48;5;235m],[10;1H(B[m[38;5;238m[48;5;235m 10 (B[m[38;5;255m[48;5;236m [10;21H(B[m[38;5;153m[48;5;235mENV(B[m[38;5;255m[48;5;235m[(B[m[38;5;81m[48;5;235m"(B[m[38;5;180m[48;5;235mclient_secret(B[m[38;5;81m[48;5;235m"(B[m[38;5;255m[48;5;235m],[11;1H(B[m[38;5;238m[48;5;235m 11 (B[m[38;5;255m[48;5;236m [11;21H(B[m[38;5;215m[48;5;235msite(B[m[38;5;255m[48;5;235m:[11;27H(B[m[38;5;81m[48;5;235m"(B[m[38;5;180m[48;5;235mhttps://accounts.google.com(B[m[38;5;81m[48;5;235m"(B[m[38;5;255m[48;5;235m,[12;1H(B[m[38;5;238m[48;5;235m 12 (B[m[38;5;255m[48;5;236m [12;21H(B[m[38;5;215m[48;5;235mtoken_url(B[m[38;5;255m[48;5;235m:[12;32H(B[m[38;5;81m[48;5;235m"(B[m[38;5;180m[48;5;235m/o/oauth2/token(B[m[38;5;81m[48;5;235m"(B[m[38;5;255m[48;5;235m,[13;1H(B[m[38;5;238m[48;5;235m 13 (B[m[38;5;255m[48;5;236m [13;21H(B[m[38;5;215m[48;5;235mauthorize_url(B[m[38;5;255m[48;5;235m:[13;36H(B[m[38;5;81m[48;5;235m"(B[m[38;5;180m[48;5;235m/o/oauth2/auth(B[m[38;5;81m[48;5;235m"(B[m[38;5;255m[48;5;235m)[14;1H(B[m[38;5;238m[48;5;235m 14 (B[m[38;5;255m[48;5;236ma(B[m[38;5;255m[48;5;235muth_token[14;16H=[14;18H(B[m[38;5;81m[48;5;235mOAuth2(B[m[38;5;255m[48;5;235m::(B[m[38;5;81m[48;5;235mAccessToken(B[m[38;5;255m[48;5;235m.from_hash(client,{(B[m[38;5;215m[48;5;235m:refresh_token[14;71H(B[m[38;5;255m[48;5;235m=>[14;74H(B[m[38;5;153m[48;5;235mENV(B[m[38;5;255m[48;5;235m[(B[m[38;5;81m[48;5;235m"(B[m[38;5;180m[48;5;235mre[15;1H(B[m[38;5;238m[48;5;235m    (B[m[38;5;180m[48;5;235mfresh_token(B[m[38;5;81m[48;5;235m"(B[m[38;5;255m[48;5;235m],[15;20H(B[m[38;5;215m[48;5;235m:expires_at[15;32H(B[m[38;5;255m[48;5;235m=>[15;35H(B[m[38;5;215m[48;5;235m3600(B[m[38;5;255m[48;5;235m})[16;1H(B[m[38;5;238m[48;5;235m 15 (B[m[38;5;255m[48;5;236m [16;13H(B[m[38;5;255m[48;5;235mauth_token[16;24H=[16;26Hauth_token.refresh![17;1H(B[m[38;5;238m[48;5;235m 16 (B[m[38;5;255m[48;5;236ms(B[m[38;5;255m[48;5;235mession[17;13H=[17;15H(B[m[38;5;81m[48;5;235mGoogleDrive(B[m[38;5;255m[48;5;235m.login_with_oauth(auth_token.token)[18;1H(B[m[38;5;238m[48;5;235m 17 (B[m[38;5;255m[48;5;236m [18;13H(B[m[38;5;153m[48;5;235m@ws[18;17H(B[m[38;5;255m[48;5;235m=[18;19Hsession.spreadsheet_by_key((B[m[38;5;153m[48;5;235mENV(B[m[38;5;255m[48;5;235m[(B[m[38;5;81m[48;5;235m"(B[m[38;5;180m[48;5;235msheet_id(B[m[38;5;81m[48;5;235m"(B[m[38;5;255m[48;5;235m]).worksheets[(B[m[38;5;215m[48;5;235m0(B[m[38;5;255m[48;5;235m][19;1H(B[m[38;5;238m[48;5;235m 18 (B[m[38;5;255m[48;5;236m [20;1H(B[m[38;5;238m[48;5;235m 19 (B[m[38;5;255m[48;5;236m [20;13H(B[m[38;5;255m[48;5;235mputs[20;18H(B[m[38;5;81m[48;5;235m"(B[m[38;5;180m[48;5;235mPlease input your student id:(B[m[38;5;81m[48;5;235m"[21;1H(B[m[38;5;238m[48;5;235m 20 (B[m[38;5;255m[48;5;236m [21;13H(B[m[38;5;153m[48;5;235m@id[21;17H(B[m[38;5;255m[48;5;235m=[21;19Hgets.chomp![22;1H(B[m[38;5;238m[48;5;235m 21 (B[m[38;5;255m[48;5;236m [23;1H(B[m[38;5;234m[48;5;242m[1mapp.rb                                                                          [1;5H[1;5H[?12l[?25h[?25l[1;5H[?12l[?25h[?25l[1;5H[1;5H[?12l[?25h[?25l[1;5H[?12l[?25h[?25l[1;5H[?12l[?25h[?25l[1;5H[?12l[?25h[?25l[1;5H[?12l[?25h[?25l[1;5H[?12l[?25h[?25l[1;5H[?12l[?25h[?25l[1;5H[?12l[?25h[?25l[1;5H[?12l[?25h[?25l[1;5H[?12l[?25h[?25l[1;5H[?12l[?25h[?25l[1;5H[?12l[?25h[?25l[1;5H[?12l[?25h[?25l[1;5H[?12l[?25h[?25l[1;5H[?12l[?25h[?25l[1;5H[?12l[?25h[?25l[1;5H[?12l[?25h[?25l[1;5H[?12l[?25h
